---
title: "七牛云的文件夹递归上传操作by Python3"
seoTitle: "upload dir to qiniu"
seoDescription: "upload dir to qiniu"
datePublished: Tue Mar 21 2023 23:05:09 GMT+0000 (Coordinated Universal Time)
cuid: clfiv5rs0000409l2019v6irs
slug: qiniuupdir
cover: https://cdn.hashnode.com/res/hashnode/image/upload/v1679439729235/b68c16ea-7b82-4b88-9fce-7d999a2a4e33.png
ogImage: https://cdn.hashnode.com/res/hashnode/image/upload/v1679439794371/4f997a38-4b6a-4de0-8268-6274e45d500f.png
tags: developer, file-upload, qiniu

---

create by grpchub-BunmJyo(twitter: bunmjyo) on 2023-03-22

注意环境配置:

python3 和 pip3 安装好qiniu依赖

pip3 install qiniu

```plaintext
#!/usr/bin/python3
# -*- coding: utf-8 -*-

'''
递归上传文件夹到七牛
'''

from qiniu import Auth, put_file
import os
import traceback

# AK = '' #你的七牛AK
# SK = '' #你的七牛SK
# local absoule path 要上传的文件夹绝对路径 这是我自己本地电脑的路径
dir = '/home/appsrv/proj/Promo_reco' 
# qiniu release path,it will replace default release path 
rlspath='jojo' # 在七牛空间发布的文件夹
# local replace path
rplpath='appsrv/proj/Promo_reco' # 需要被替换的路径,在linux下即去掉首个文件夹路径
# qiniu bucket name
bucket_name = 'webres1' 
q = Auth(AK, SK)
token = q.upload_token(bucket_name)

def updir(dirpath):
    if os.path.isdir(dirpath):#文件夹
        sublist = os.listdir(dirpath)
        for sub in sublist:
            updir(dirpath+'/'+sub)
    else:#文件
        fpath, fname = os.path.split(dirpath)
        patharr = fpath.split('/')
        try:
            key = getKey(dirpath)
            print('key-->'+key)
            ret, info = put_file(token, key, dirpath)
            print(ret)
        except:
            traceback.print_exc()

def getKey(file):
    key = ''
    fpath, fname = os.path.split(file)
    patharr = fpath.split('/')
    if len(patharr) >= 2:
    #    key = '' + fname
        #key = '/'.join(patharr[(len(patharr)-3):]) + '/' + fname
        key = '/'.join(patharr[2:]) + '/' + fname
        if len(rplpath) >0 :
            key = key.replace('appsrv/proj/Promo_reco',rlspath)
    else:
        key = fname
    return key

if __name__ == '__main__':
    updir(dir)
```